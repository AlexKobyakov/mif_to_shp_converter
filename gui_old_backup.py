output_format')}")
        
        self.input_file_button.setText(f"üìÇ {translations.get_text('browse')}")
        self.input_folder_button.setText(f"üìÇ {translations.get_text('browse')}")
        self.output_folder_button.setText(f"üìÇ {translations.get_text('browse')}")
        
        self.threading_group.setTitle(f"‚ö° {translations.get_text('threading_settings')}")
        self.thread_count_label.setText(f"üßµ {translations.get_text('thread_count')}")
        
        self.crs_group.setTitle(f"üåç {translations.get_text('coordinate_system')}")
        self.crs_hint_label.setText(f"üìù {translations.get_text('crs_format_hint')}")
        self.add_to_project_cb.setText(f"‚úÖ {translations.get_text('add_to_project')}")
        
        self.progress_label.setText(f"üìä {translations.get_text('progress')}")
        
        # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–±–æ–≤
        self.tab_widget.setTabText(0, f"üìã {translations.get_text('logs')}")
        self.tab_widget.setTabText(1, f"üìà {translations.get_text('results')}")
        
        # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ —Ç–∞–±–ª–∏—Ü—ã
        self.results_table.setHorizontalHeaderLabels([
            f"üìÑ {translations.get_text('file')}",
            f"üìä {translations.get_text('status')}",
            f"üí¨ {translations.get_text('message')}"
        ])
        
        # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–æ–∫
        if 'Converting' in self.convert_button.text() or '–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è' in self.convert_button.text():
            self.convert_button.setText(f"‚è≥ {translations.get_text('converting')}")
        else:
            self.convert_button.setText(f"üöÄ {translations.get_text('start_conversion')}")
            
        self.cancel_button.setText(f"‚ùå {translations.get_text('cancel')}")
        self.clear_log_button.setText(f"üßπ {translations.get_text('clear_logs')}")

    def showAuthorInfo(self):
        """–ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –∞–≤—Ç–æ—Ä–µ"""
        author_dialog = QMessageBox()
        author_dialog.setWindowTitle('üë§ Author Information')
        author_dialog.setTextFormat(Qt.RichText)
        author_dialog.setText(f"""
        <div style="text-align: center; padding: 20px;">
            <h2 style="color: #3498db;">üéØ MIF/TAB to SHP/GeoJSON Converter</h2>
            <hr style="border: 1px solid #bdc3c7;">
            <p><b>üë®‚Äçüíª Author:</b> –ö–æ–±—è–∫–æ–≤ –ê–ª–µ–∫—Å–∞–Ω–¥—Ä –í–∏–∫—Ç–æ—Ä–æ–≤–∏—á<br>
            <i>(Alex Kobyakov)</i></p>
            <p><b>üìß Email:</b> <a href="mailto:kobyakov@lesburo.ru">kobyakov@lesburo.ru</a></p>
            <p><b>üìÖ Year:</b> 2025</p>
            <p><b>üè¢ Organization:</b> Lesburo</p>
            <hr style="border: 1px solid #bdc3c7;">
            <p style="color: #7f8c8d; font-style: italic;">
            Professional GIS data conversion tool<br>
            Supporting multiple languages and formats
            </p>
        </div>
        """)
        author_dialog.setStandardButtons(QMessageBox.Ok)
        author_dialog.exec_()

    def onModeChanged(self):
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–º–µ–Ω—ã —Ä–µ–∂–∏–º–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏"""
        is_batch = self.batch_mode.isChecked()
        self.single_widget.setVisible(not is_batch)
        self.batch_widget.setVisible(is_batch)

    def selectInputFile(self):
        """–í—ã–±–æ—Ä –≤—Ö–æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞"""
        filename, _ = QFileDialog.getOpenFileName(
            self, translations.get_text('select_input_file'), '', 
            translations.get_text('supported_formats'))
        if filename:
            self.input_file_line.setText(filename)
            if not self.output_folder_line.text():
                self.output_folder_line.setText(os.path.dirname(filename))

    def selectInputFolder(self):
        """–í—ã–±–æ—Ä –≤—Ö–æ–¥–Ω–æ–π –ø–∞–ø–∫–∏"""
        folder = QFileDialog.getExistingDirectory(self, translations.get_text('select_input_folder'))
        if folder:
            self.input_folder_line.setText(folder)
            if not self.output_folder_line.text():
                self.output_folder_line.setText(folder)

    def selectOutputFolder(self):
        """–í—ã–±–æ—Ä –≤—ã—Ö–æ–¥–Ω–æ–π –ø–∞–ø–∫–∏"""
        folder = QFileDialog.getExistingDirectory(self, translations.get_text('select_output_folder'))
        if folder:
            self.output_folder_line.setText(folder)

    def startConversion(self):
        """–ó–∞–ø—É—Å–∫ –ø—Ä–æ—Ü–µ—Å—Å–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏"""
        # –°–±–æ—Ä —Ñ–∞–π–ª–æ–≤ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
        files_to_process = []
        
        if self.single_mode.isChecked():
            input_file = self.input_file_line.text()
            if not input_file or not os.path.exists(input_file):
                QMessageBox.warning(self, 'Error', translations.get_text('error_no_input_file'))
                return
            files_to_process = [input_file]
        else:
            input_folder = self.input_folder_line.text()
            if not input_folder or not os.path.exists(input_folder):
                QMessageBox.warning(self, 'Error', translations.get_text('error_no_input_folder'))
                return
            
            # –ü–æ–∏—Å–∫ –≤—Å–µ—Ö –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö —Ñ–∞–π–ª–æ–≤ –≤ –ø–∞–ø–∫–µ (MIF –∏ TAB)
            mif_pattern = os.path.join(input_folder, '*.mif')
            tab_pattern = os.path.join(input_folder, '*.tab')
            files_to_process = glob.glob(mif_pattern) + glob.glob(tab_pattern)
            
            if not files_to_process:
                QMessageBox.warning(self, 'Error', translations.get_text('error_no_files_found'))
                return
        
        output_folder = self.output_folder_line.text()
        if not output_folder:
            QMessageBox.warning(self, 'Error', translations.get_text('error_no_output_folder'))
            return
        
        # –°–æ–∑–¥–∞–Ω–∏–µ –≤—ã—Ö–æ–¥–Ω–æ–π –ø–∞–ø–∫–∏ –µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
        os.makedirs(output_folder, exist_ok=True)
        
        crs_text = self.crs_text.toPlainText().strip()
        if not crs_text:
            QMessageBox.warning(self, 'Error', translations.get_text('error_no_crs'))
            return
        
        # –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—ã—Ö–æ–¥–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞
        output_format = 'GeoJSON' if 'GeoJSON' in self.output_format_combo.currentText() else 'ESRI Shapefile'
        
        # –û—á–∏—Å—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        self.results_table.setRowCount(0)
        self.log_message(f"üöÄ === {translations.get_text('start_conversion')} {datetime.now().strftime('%Y-%m-%d %H:%M:%S')} ===")
        
        # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ UI –¥–ª—è –ø—Ä–æ—Ü–µ—Å—Å–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏
        self.progress_bar.setVisible(True)
        self.progress_bar.setValue(0)
        self.convert_button.setEnabled(False)
        self.convert_button.setText(f"‚è≥ {translations.get_text('converting')}")
        
        # –°–æ–∑–¥–∞–Ω–∏–µ –∏ –∑–∞–ø—É—Å–∫ –≤–æ—Ä–∫–µ—Ä–∞
        max_workers = self.threads_spinbox.value()
        self.worker = ConversionWorker(files_to_process, output_folder, crs_text, output_format, max_workers)
        self.worker_thread = QThread()
        self.worker.moveToThread(self.worker_thread)
        
        # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–æ–≤
        self.worker_thread.started.connect(self.worker.run)
        self.worker.progress.connect(self.progress_bar.setValue)
        self.worker.log_message.connect(self.log_message)
        self.worker.file_completed.connect(self.onFileCompleted)
        self.worker.finished.connect(self.onConversionFinished)
        self.worker.error.connect(self.onConversionError)
        
        # –ó–∞–ø—É—Å–∫
        self.worker_thread.start()

    def cancelConversion(self):
        """–û—Ç–º–µ–Ω–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏"""
        if self.worker:
            self.worker.cancel()
            self.log_message(f"‚ö†Ô∏è {translations.get_text('conversion_cancelled')}")

    def clearLogs(self):
        """–û—á–∏—Å—Ç–∫–∞ –ª–æ–≥–æ–≤ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤"""
        self.log_text.clear()
        self.results_table.setRowCount(0)
        self.log_message("üßπ Logs and results cleared")

    def onFileCompleted(self, filename, success, message):
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ñ–∞–π–ª–∞"""
        # –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤ —Ç–∞–±–ª–∏—Ü—É
        row = self.results_table.rowCount()
        self.results_table.insertRow(row)
        
        # –§–∞–π–ª
        file_item = QTableWidgetItem(filename)
        file_item.setToolTip(filename)
        self.results_table.setItem(row, 0, file_item)
        
        # –°—Ç–∞—Ç—É—Å —Å –∏–∫–æ–Ω–∫–∞–º–∏
        status_text = f"‚úÖ {translations.get_text('success')}" if success else f"‚ùå {translations.get_text('error')}"
        status_item = QTableWidgetItem(status_text)
        
        if success:
            status_item.setBackground(QColor('#d5f4e6'))  # –°–≤–µ—Ç–ª–æ-–∑–µ–ª–µ–Ω—ã–π
            status_item.setForeground(QColor('#27ae60'))  # –¢–µ–º–Ω–æ-–∑–µ–ª–µ–Ω—ã–π —Ç–µ–∫—Å—Ç
        else:
            status_item.setBackground(QColor('#fadbd8'))  # –°–≤–µ—Ç–ª–æ-–∫—Ä–∞—Å–Ω—ã–π
            status_item.setForeground(QColor('#e74c3c'))  # –¢–µ–º–Ω–æ-–∫—Ä–∞—Å–Ω—ã–π —Ç–µ–∫—Å—Ç
            
        self.results_table.setItem(row, 1, status_item)
        
        # –°–æ–æ–±—â–µ–Ω–∏–µ
        message_item = QTableWidgetItem(message)
        message_item.setToolTip(message)
        self.results_table.setItem(row, 2, message_item)
        
        # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å—Ç—Ä–æ–∫–µ
        self.results_table.scrollToBottom()

    def onConversionFinished(self):
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏"""
        self.progress_bar.setValue(100)
        self.convert_button.setEnabled(True)
        self.convert_button.setText(f"üöÄ {translations.get_text('start_conversion')}")
        self.log_message(f"üéâ === Conversion completed {datetime.now().strftime('%Y-%m-%d %H:%M:%S')} ===")
        
        # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        total_files = self.results_table.rowCount()
        success_count = 0
        error_count = 0
        
        for row in range(total_files):
            status_item = self.results_table.item(row, 1)
            if status_item and '‚úÖ' in status_item.text():
                success_count += 1
            else:
                error_count += 1
        
        self.log_message(f"üìä Statistics: {success_count} successful, {error_count} errors out of {total_files} files")
        
        # –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤ –ø—Ä–æ–µ–∫—Ç –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
        if self.add_to_project_cb.isChecked() and success_count > 0:
            self.addResultsToProject()
        
        # –û—á–∏—Å—Ç–∫–∞ –≤–æ—Ä–∫–µ—Ä–∞
        if self.worker_thread:
            self.worker_thread.quit()
            self.worker_thread.wait()
            self.worker_thread = None
            self.worker = None
        
        # –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏
        if success_count == total_files:
            QMessageBox.information(self, 'üéâ Success', 
                                  f'All {total_files} files converted successfully!')
        elif success_count > 0:
            QMessageBox.warning(self, '‚ö†Ô∏è Partial Success', 
                              f'{success_count} files converted successfully, {error_count} failed.')
        else:
            QMessageBox.critical(self, '‚ùå Error', 
                               'No files were converted successfully.')

    def onConversionError(self, error_message):
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –æ—à–∏–±–∫–∏"""
        self.log_message(f"üî• CRITICAL ERROR: {error_message}")
        QMessageBox.critical(self, translations.get_text('critical_error'), error_message)
        self.onConversionFinished()

    def addResultsToProject(self):
        """–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –≤ –ø—Ä–æ–µ–∫—Ç"""
        output_folder = self.output_folder_line.text()
        crs_text = self.crs_text.toPlainText().strip()
        output_format = 'GeoJSON' if 'GeoJSON' in self.output_format_combo.currentText() else 'ESRI Shapefile'
        
        # –°–æ–∑–¥–∞–Ω–∏–µ CRS –æ–±—ä–µ–∫—Ç–∞
        crs = QgsCoordinateReferenceSystem()
        if crs_text.startswith('EPSG:'):
            epsg_code = int(crs_text.split(':')[1])
            crs.createFromId(epsg_code)
        else:
            crs.createFromString(crs_text)
        
        added_count = 0
        for row in range(self.results_table.rowCount()):
            status_item = self.results_table.item(row, 1)
            if status_item and '‚úÖ' in status_item.text():
                filename = self.results_table.item(row, 0).text()
                
                if output_format == 'GeoJSON':
                    # –î–ª—è GeoJSON —Ñ–∞–π–ª–æ–≤
                    if filename.lower().endswith('.mif'):
                        output_file = os.path.join(output_folder, filename.replace('.mif', '.geojson'))
                        layer_name = filename.replace('.mif', '')
                    else:  # .tab
                        output_file = os.path.join(output_folder, filename.replace('.tab', '.geojson'))
                        layer_name = filename.replace('.tab', '')
                else:
                    # –î–ª—è Shapefile
                    if filename.lower().endswith('.mif'):
                        output_file = os.path.join(output_folder, filename.replace('.mif', '.shp'))
                        layer_name = filename.replace('.mif', '')
                    else:  # .tab
                        output_file = os.path.join(output_folder, filename.replace('.tab', '.shp'))
                        layer_name = filename.replace('.tab', '')
                
                if os.path.exists(output_file):
                    layer = QgsVectorLayer(output_file, layer_name, "ogr")
                    if layer.isValid():
                        layer.setCrs(crs)
                        QgsProject.instance().addMapLayer(layer)
                        added_count += 1
        
        if added_count > 0:
            self.log_message(f"üìÅ Added to project: {added_count} layers")

    def log_message(self, message):
        """–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –ª–æ–≥ —Å —Ü–≤–µ—Ç–æ–≤–æ–π —Ä–∞—Å–∫—Ä–∞—Å–∫–æ–π"""
        timestamp = datetime.now().strftime('%H:%M:%S')
        
        # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ü–≤–µ—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–∏–ø–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
        if message.startswith('üöÄ') or message.startswith('üéâ'):
            color = '#2ecc71'  # –ó–µ–ª–µ–Ω—ã–π –¥–ª—è —É—Å–ø–µ—Ö–∞
        elif message.startswith('‚ö†Ô∏è'):
            color = '#f39c12'  # –û—Ä–∞–Ω–∂–µ–≤—ã–π –¥–ª—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π
        elif message.startswith('üî•') or message.startswith('‚ùå'):
            color = '#e74c3c'  # –ö—Ä–∞—Å–Ω—ã–π –¥–ª—è –æ—à–∏–±–æ–∫
        elif message.startswith('‚úÖ'):
            color = '#27ae60'  # –¢–µ–º–Ω–æ-–∑–µ–ª–µ–Ω—ã–π –¥–ª—è —É—Å–ø–µ—à–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
        elif message.startswith('‚úó'):
            color = '#c0392b'  # –¢–µ–º–Ω–æ-–∫—Ä–∞—Å–Ω—ã–π –¥–ª—è –æ—à–∏–±–æ–∫ —Ñ–∞–π–ª–æ–≤
        elif message.startswith('üìä') or message.startswith('üìÅ'):
            color = '#3498db'  # –°–∏–Ω–∏–π –¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
        else:
            color = '#ecf0f1'  # –ë–µ–ª—ã–π –¥–ª—è –æ–±—ã—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
        
        formatted_message = f'<span style="color: #95a5a6;">[{timestamp}]</span> <span style="color: {color};">{message}</span>'
        self.log_text.append(formatted_message)
        
        # –ê–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ –∫–æ–Ω—Ü—É
        cursor = self.log_text.textCursor()
        cursor.movePosition(cursor.End)
        self.log_text.setTextCursor(cursor)

    def closeEvent(self, event):
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è –æ–∫–Ω–∞"""
        if self.worker and self.worker_thread and self.worker_thread.isRunning():
            reply = QMessageBox.question(
                self, 
                translations.get_text('confirmation'), 
                translations.get_text('confirm_close'),
                QMessageBox.Yes | QMessageBox.No,
                QMessageBox.No
            )
            if reply == QMessageBox.Yes:
                self.cancelConversion()
                if self.worker_thread:
                    self.worker_thread.quit()
                    self.worker_thread.wait()
                event.accept()
            else:
                event.ignore()
        else:
            event.accept()
